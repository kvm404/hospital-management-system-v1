{% extends 'base.html' %}
{% block subtitle %}Dashboard{% endblock %}

<!-- Navbar -->
{% block navbrand %}Welcome <strong>{{current_user.name}}</strong>{% endblock %}

{% block navlinks %}
<li class="nav-item me-3">
  <form class="d-flex" action="{{ url_for('patient_search') }}" method="GET">
      <input class="form-control me-2" type="search" name="q" placeholder="Search Doctors by Name or Dept" required style="width: 300px;">
      <button class="btn btn-outline-success" type="submit">Search</button>
  </form>
</li>
<li class="nav-item">
  <a class="nav-link" href="{{ url_for('edit_profile', id=current_user.id) }}">Edit Profile</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="{{ url_for('history', id=current_user.id) }}">History</a>
</li>
{% endblock %}

{% block content %}

<!-- Departments -->
<div class="m-2">
<h3>Departments</h3>
<div class="table-body">
  <table class="table table-hover mb-0">
    <tbody>
      {% if departments %}
        {% for dept in departments %}
        <tr>
          <td>{{ dept.name }}</td>
          <td class="text-center">
            <a href="{{ url_for('department_details', dept_id=dept.id) }}"
               class="btn btn-outline-primary btn-sm">View Details</a>
          </td>
        </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="2" class="text-center text-muted">Departments are not updated yet!</td>
        </tr>
      {% endif %}
    </tbody>
  </table>
</div>
</div>


<!-- Appointments -->
<br>
<div class="m-2">
<h3>Upcoming Appointments</h3>
<div class="table-body">
    <table class="table table-hover mb-0">
        <thead class="sticky-top">
            <tr>
              <th scope="col">Sr No.</th>
              <th scope="col">Doctor Name</th>
              <th scope="col">Department</th>
              <th scope="col">Date</th>
              <th scope="col">Time</th>
              <th scope="col"></th>
            </tr>
        </thead>          
        <tbody>
          {% if appointments %}
            {% for ap in appointments %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>{{ ap.doctor.user.name }}</td>
              <td>{{ ap.doctor.department.name }}</td>
              <td>{{ ap.slot.date.strftime('%d/%m/%Y') }}</td>
              <td>{% if ap.slot.time == 'morning' %}8am-12pm{% else %}4pm-9pm{% endif %}</td>
              <td>
                {% if ap.status == 'booked' %}
                  <form method="POST" action="{{ url_for('cancel_appointment', id=ap.id) }}" style="display:inline;">
                    <button class="btn btn-danger btn-sm" type="submit">Cancel</button>
                  </form>
                {% else %}
                  <span class="badge border text-white bg-secondary">{{ ap.status | capitalize }}</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="6" class="text-center text-muted">
                You have no upcoming appointments.
              </td>
            </tr>
          {% endif %}
      </tbody>
    </table>
</div>
</div>
{% endblock %}